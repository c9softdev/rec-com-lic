<div class="content">
  <div class="panel-header bg-primary-gradient py-4">
    <div class="page-inner py-3 mt--3">
      <div class="d-flex align-items-left flex-column">
        <div>
          <h2 class="text-white fw-bold mb-0">
            <i class="fas fa-key mr-2"></i>Change Password
          </h2>
          <p class="text-white mb-0 mt-1 opacity-8">Update your account password securely</p>
        </div>
      </div>
    </div>
  </div>
  <div class="page-inner mt--4">
    <div class="row justify-content-start">
      <div class="col-md-6 col-lg-6">
        <div class="card shadow-sm">
          <div class="card-body">
            <form [formGroup]="changePasswordForm" (ngSubmit)="onSubmit()" autocomplete="off">
              <!-- Current Password -->
              <div class="input-group position-relative mb-4">
                <input [type]="showOldPassword ? 'text' : 'password'" 
                       autofocus 
                       class="form-control pr-5" 
                       id="oldPassword" 
                       formControlName="oldPassword" 
                       autocomplete="current-password"
                       [ngClass]="{
                         'is-invalid': changePasswordForm.get('oldPassword')?.invalid && submitted,
                         'active': changePasswordForm.get('oldPassword')?.value
                       }">
                <label for="oldPassword">Current Password <span class="text-danger">*</span></label>
                <button type="button" 
                        class="btn password-eye-btn position-absolute end-0 top-50 translate-middle-y" 
                        style="right: 1rem;" 
                        (click)="togglePasswordVisibility('oldPassword')" 
                        tabindex="-1">
                  <i class="fas" [class.fa-eye]="!showOldPassword" [class.fa-eye-slash]="showOldPassword"></i>
                </button>
                <div *ngIf="changePasswordForm.get('oldPassword')?.invalid && submitted" class="invalid-feedback">
                  <div *ngIf="changePasswordForm.get('oldPassword')?.errors?.['required']">
                    <i class="fas fa-exclamation-circle mr-1"></i>Current password is required
                  </div>
                  <div *ngIf="changePasswordForm.get('oldPassword')?.errors?.['minlength']">
                    <i class="fas fa-exclamation-circle mr-1"></i>Password must be at least 6 characters
                  </div>
                </div>
              </div>

              <!-- New Password -->
              <div class="input-group position-relative mb-4">
                <input [type]="showNewPassword ? 'text' : 'password'" 
                       class="form-control pr-5" 
                       id="newPassword" 
                       formControlName="newPassword" 
                       autocomplete="new-password"
                       [ngClass]="{
                         'is-invalid': changePasswordForm.get('newPassword')?.invalid && submitted,
                         'active': changePasswordForm.get('newPassword')?.value
                       }">
                <label for="newPassword">New Password <span class="text-danger">*</span></label>
                <button type="button" 
                        class="btn password-eye-btn position-absolute end-0 top-50 translate-middle-y" 
                        style="right: 1rem;" 
                        (click)="togglePasswordVisibility('newPassword')" 
                        tabindex="-1">
                  <i class="fas" [class.fa-eye]="!showNewPassword" [class.fa-eye-slash]="showNewPassword"></i>
                </button>
                <div *ngIf="changePasswordForm.get('newPassword')?.invalid && submitted" class="invalid-feedback">
                  <div *ngIf="changePasswordForm.get('newPassword')?.errors?.['required']">
                    <i class="fas fa-exclamation-circle mr-1"></i>New password is required
                  </div>
                  <div *ngIf="changePasswordForm.get('newPassword')?.errors?.['minlength']">
                    <i class="fas fa-exclamation-circle mr-1"></i>Password must be at least 6 characters
                  </div>
                </div>
                <div class="password-strength-indicator d-flex align-items-center position-absolute" 
                     style="right: 3.5rem; top: 50%; transform: translateY(-50%);"
                     *ngIf="showPasswordStrengthIcon">
                  <i class="fas" 
                     [ngClass]="passwordStrengthIcon" 
                     [ngStyle]="{'color': passwordStrengthColor, 'transition': 'color 0.2s'}"
                     data-bs-toggle="tooltip" 
                     data-bs-placement="top" 
                     title="Password Strength"></i>
                </div>
              </div>

              <!-- Confirm New Password -->
              <div class="input-group position-relative mb-4">
                <input [type]="showConfirmPassword ? 'text' : 'password'" 
                       class="form-control pr-5" 
                       id="confirmPassword" 
                       formControlName="confirmPassword" 
                       autocomplete="new-password"
                       [ngClass]="{
                         'is-invalid': (changePasswordForm.get('confirmPassword')?.invalid || changePasswordForm.errors?.['mismatch']) && submitted,
                         'active': changePasswordForm.get('confirmPassword')?.value
                       }">
                <label for="confirmPassword">Confirm New Password <span class="text-danger">*</span></label>
                <button type="button" 
                        class="btn password-eye-btn position-absolute end-0 top-50 translate-middle-y" 
                        style="right: 1rem;" 
                        (click)="togglePasswordVisibility('confirmPassword')" 
                        tabindex="-1">
                  <i class="fas" [class.fa-eye]="!showConfirmPassword" [class.fa-eye-slash]="showConfirmPassword"></i>
                </button>
                <div *ngIf="(changePasswordForm.get('confirmPassword')?.invalid || changePasswordForm.errors?.['mismatch']) && submitted" 
                     class="invalid-feedback">
                  <div *ngIf="changePasswordForm.get('confirmPassword')?.errors?.['required']">
                    <i class="fas fa-exclamation-circle mr-1"></i>Password confirmation is required
                  </div>
                  <div *ngIf="changePasswordForm.errors?.['mismatch']">
                    <i class="fas fa-exclamation-circle mr-1"></i>Passwords do not match
                  </div>
                </div>
                <div class="password-match-indicator d-flex align-items-center position-absolute" 
                     style="right: 3.5rem; top: 50%; transform: translateY(-50%);">
                  <i *ngIf="showConfirmPasswordMatchIcon" 
                     class="fas fa-check-circle text-success" 
                     style="transition: color 0.2s"
                     data-bs-toggle="tooltip" 
                     data-bs-placement="top" 
                     title="Passwords match!"></i>
                  <i *ngIf="showConfirmPasswordMismatchIcon" 
                     class="fas fa-times-circle text-danger" 
                     style="transition: color 0.2s"
                     data-bs-toggle="tooltip" 
                     data-bs-placement="top" 
                     title="Passwords do not match!"></i>
                </div>
              </div>

              <!-- Action Buttons -->
              <div class="form-group mt-4 mb-0 d-flex align-items-center">
                <button type="submit" 
                        class="btn btn-outline-primary btn-round mr-2">
                  <span *ngIf="loading" class="spinner-border spinner-border-sm mr-2"></span>
                  <i class="fas" [class.fa-key]="!loading" [class.fa-spinner]="loading" [class.fa-spin]="loading"></i>
                  <span class="ml-1">{{loading ? 'Updating Password...' : 'Update Password'}}</span>
                </button>
                <button type="button" 
                        class="btn btn-outline-dark btn-round" 
                        (click)="changePasswordForm.reset()"
                        [disabled]="loading">
                  <i class="fas fa-undo mr-1"></i>Clear
                </button>
              </div>

              <!-- Password Requirements -->
              <div class="password-requirements mt-4">
                <h6 class="text-muted mb-2"><i class="fas fa-info-circle mr-1"></i>Password Requirements:</h6>
                <ul class="text-muted small mb-0">
                  <li>At least 6 characters long</li>
                </ul>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>