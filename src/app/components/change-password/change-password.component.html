<div class="content">
  <!-- Header -->
  <div class="panel-header bg-primary-gradient py-4">
    <div class="page-inner py-3 mt--3">
      <h2 class="text-white fw-bold mb-1">
        <i class="fas fa-key me-2"></i>Change Password
      </h2>
      <p class="text-white opacity-8 mb-0">
        Update your account password securely
      </p>
    </div>
  </div>

  <!-- Content -->
  <div class="page-inner mt--4">
    <div class="row">
      <div class="col-md-8 col-lg-7">
        <div class="card shadow-sm border-0">
          <div class="card-body p-4">

            <form [formGroup]="changePasswordForm"
                  (ngSubmit)="onSubmit()"
                  autocomplete="off">

              <!-- Current Password -->
              <div class="form-floating mb-4 position-relative">
                <input
                  [type]="showOldPassword ? 'text' : 'password'"
                  class="form-control"
                  id="oldPassword"
                  formControlName="oldPassword"
                  autocomplete="current-password"
                  [ngClass]="{'is-invalid': changePasswordForm.get('oldPassword')?.invalid && submitted}">
                <label for="oldPassword">Current Password *</label>

                <button type="button"
                        class="btn btn-sm btn-light password-toggle"
                        (click)="togglePasswordVisibility('oldPassword')"
                        tabindex="-1">
                  <i class="fas"
                     [class.fa-eye]="!showOldPassword"
                     [class.fa-eye-slash]="showOldPassword"></i>
                </button>

                <div class="invalid-feedback">
                  <div *ngIf="changePasswordForm.get('oldPassword')?.errors?.['required']">
                    Current password is required
                  </div>
                  <div *ngIf="changePasswordForm.get('oldPassword')?.errors?.['minlength']">
                    Minimum 6 characters required
                  </div>
                </div>
              </div>

              <!-- New Password -->
              <div class="form-floating mb-4 position-relative">
                <input
                  [type]="showNewPassword ? 'text' : 'password'"
                  class="form-control"
                  id="newPassword"
                  formControlName="newPassword"
                  autocomplete="new-password"
                  [ngClass]="{'is-invalid': changePasswordForm.get('newPassword')?.invalid && submitted}">
                <label for="newPassword">New Password *</label>

                <button type="button"
                        class="btn btn-sm btn-light password-toggle"
                        (click)="togglePasswordVisibility('newPassword')"
                        tabindex="-1">
                  <i class="fas"
                     [class.fa-eye]="!showNewPassword"
                     [class.fa-eye-slash]="showNewPassword"></i>
                </button>

                <span *ngIf="showPasswordStrengthIcon"
                      class="password-indicator">
                  <i class="fas"
                     [ngClass]="passwordStrengthIcon"
                     [ngStyle]="{'color': passwordStrengthColor}">
                  </i>
                </span>

                <div class="invalid-feedback">
                  <div *ngIf="changePasswordForm.get('newPassword')?.errors?.['required']">
                    New password is required
                  </div>
                  <div *ngIf="changePasswordForm.get('newPassword')?.errors?.['minlength']">
                    Minimum 6 characters required
                  </div>
                </div>
              </div>

              <!-- Confirm Password -->
              <div class="form-floating mb-4 position-relative">
                <input
                  [type]="showConfirmPassword ? 'text' : 'password'"
                  class="form-control"
                  id="confirmPassword"
                  formControlName="confirmPassword"
                  autocomplete="new-password"
                  [ngClass]="{
                    'is-invalid':
                    (changePasswordForm.get('confirmPassword')?.invalid ||
                    changePasswordForm.errors?.['mismatch']) && submitted
                  }">
                <label for="confirmPassword">Confirm New Password *</label>

                <button type="button"
                        class="btn btn-sm btn-light password-toggle"
                        (click)="togglePasswordVisibility('confirmPassword')"
                        tabindex="-1">
                  <i class="fas"
                     [class.fa-eye]="!showConfirmPassword"
                     [class.fa-eye-slash]="showConfirmPassword"></i>
                </button>

                <span class="password-indicator">
                  <i *ngIf="showConfirmPasswordMatchIcon"
                     class="fas fa-check-circle text-success"></i>
                  <i *ngIf="showConfirmPasswordMismatchIcon"
                     class="fas fa-times-circle text-danger"></i>
                </span>

                <div class="invalid-feedback">
                  <div *ngIf="changePasswordForm.get('confirmPassword')?.errors?.['required']">
                    Confirmation is required
                  </div>
                  <div *ngIf="changePasswordForm.errors?.['mismatch']">
                    Passwords do not match
                  </div>
                </div>
              </div>

              <!-- Actions -->
              <div class="d-flex gap-2 mt-4">
                <button type="submit"
                        class="btn btn-primary"
                        [disabled]="loading">
                  <span *ngIf="loading" class="spinner-border spinner-border-sm me-2"></span>
                  {{ loading ? 'Updating...' : 'Update Password' }}
                </button>

                <button type="button"
                        class="btn btn-outline-secondary"
                        (click)="changePasswordForm.reset()"
                        [disabled]="loading">
                  Clear
                </button>
              </div>

              <!-- Password Rules -->
              <div class="alert alert-light mt-4 mb-0 small">
                <i class="fas fa-info-circle me-1"></i>
                Password must be at least 6 characters long
              </div>

            </form>

          </div>
        </div>
      </div>
    </div>
  </div>
</div>