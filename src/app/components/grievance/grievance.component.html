<div class="content">
  <div class="page-inner">
    <!-- Search Section -->
    <div class="row" *ngIf="listRecdFlg">
      <div class="col-md-12">
        <div class="card">
          <div
            class="sticky-top-section"
            [ngClass]="{ 'search-hidden': !showSearchSection }"
          >
            <!-- Search Section with Toggle Button -->
            <div class="card-body position-relative" *ngIf="showSearchSection">
              <button
                class="toggle-search-btn-minimal"
                (click)="toggleSearchSection()"
                type="button"
                data-bs-toggle="tooltip"
                title="Hide search"
              >
                <i class="fas fa-chevron-up"></i>
              </button>
              <form [formGroup]="searchForm" (ngSubmit)="onSearch()">
                <div class="row align-items-center">
                  <div class="col-md-3">
                    <div class="input-group">
                      <input
                        type="text"
                        class="form-control"
                        id="stitle"
                        formControlName="stitle"
                        (blur)="checkInput($event.target)"
                      />
                      <label for="stitle">Name</label>
                    </div>
                  </div>
                  <div class="col-md-3">
                    <div class="input-group">
                      <input
                        type="text"
                        class="form-control"
                        id="semail"
                        formControlName="semail"
                        (blur)="checkInput($event.target)"
                      />
                      <label for="semail">Email</label>
                    </div>
                  </div>
                  <div class="col-md-3">
                    <div class="input-group">
                      <input
                        type="text"
                        class="form-control"
                        id="spassport"
                        formControlName="spassport"
                        (blur)="checkInput($event.target)"
                      />
                      <label for="spassport">Passport</label>
                    </div>
                  </div>
                  <div class="col-md-3 d-flex align-items-end">
                    <div class="form-group w-100">
                      <button
                        class="btn btn-outline-primary btn-round mr-2"
                        type="submit"
                      >
                        <i class="fas fa-search mr-1"></i>Search
                      </button>
                      <button
                        class="btn btn-outline-dark btn-round"
                        type="button"
                        (click)="onClearSearch()"
                      >
                        <i class="fas fa-times mr-1"></i>Clear
                      </button>
                    </div>
                  </div>
                </div>
              </form>
            </div>
            <button
              *ngIf="!showSearchSection"
              class="toggle-search-btn-minimal show-btn"
              (click)="toggleSearchSection()"
              type="button"
              data-bs-toggle="tooltip"
              title="Show search"
            >
              <i class="fas fa-chevron-down"></i>
            </button>
            <div class="card-header">
              <div class="d-flex align-items-center justify-content-between">
                <h4 class="card-title mb-0">
                  Grievance List
                  <span
                    class="ml-2"
                    style="
                      font-size: 14px;
                      font-weight: normal;
                      color: var(--primary-color);
                    "
                  >
                    ({{
                      (totalRecords | number : "1.0-0") === "0"
                        ? "0 record"
                        : totalRecords + " records"
                    }})
                  </span>
                </h4>
                <div class="action-buttons">
                  @if ((deleteOption != '' && deleteOption == '1') || (userId
                  === '1' && userType == '1')) {
                  <button
                    class="btn btn-outline-danger btn-round"
                    (click)="onDeleteClick()"
                  >
                    <i class="fas fa-trash mr-1"></i>Delete
                    {{
                      selectedItems.size > 0
                        ? " (" + selectedItems.size + ")"
                        : ""
                    }}
                  </button>
                  }
                </div>
              </div>
            </div>
          </div>
          <!-- Data Table Section -->
          <div class="table-section">
            <div
              class="table-responsive"
              [ngClass]="{ 'table-full-height': !showSearchSection }"
            >
              <table class="table table-hover mb-0">
                <thead class="thead-light sticky-table-header">
                  <tr>
                    <th class="text-center" style="width: 3%;">
                      <input type="checkbox" class="custom-checkbox-modern"
                        [checked]="selectedItems.size === grievances.length" (change)="onSelectAll($event)">
                    </th>
                    <th style="width: 4%;">S.NO.</th>
                    <th style="width: 15%;">Name</th>
                    <th>Email</th>
                    <th>Passport</th>
                    <th>Eqama No</th>
                    <th style="width: 12%;">Employer's Name</th>
                    <th style="width: 12%;">Submission Date</th>
                    <th style="width: 5%;" class="text-center">View</th>
                    <th style="width: 5%;" class="text-center">Reply</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of grievances; let i = index">
                    <td class="text-center">
                      <input type="checkbox" class="custom-checkbox-modern" [checked]="selectedItems.has(item.id)"
                        (change)="onItemSelect(item.id, $event)">
                    </td>
                    <td style="text-align: center;">{{ item.sno }}</td>
                    <td>{{ item.name }}</td>
                    <td>{{ item.email }}</td>
                    <td>{{ item.passport }}</td>
                    <td>{{ item.var_eqama_no }}</td>
                    <td>{{ item.employername }}</td>
                    <td>{{ item.cdate }}</td>
                    <td class="text-center">
                      <button type="button" class="btn btn-icon btn-link" title="View Record"
                        (click)="onViewClick(item)">
                        <i class="fa fa-eye status-icon" style="color: darkcyan;"></i>
                      </button>
                    </td>
                    <td class="text-center">
                      <button type="button" class="btn btn-icon btn-link" title="Reply" (click)="onReplyClick(item)">
                        <i class="fa fa-envelope status-icon" style="color: #007bff;"></i>
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="grievances.length === 0" class="table-no-data-row">
                    <td colspan="10" class="table-no-data-cell">
                      <div class="no-data-center-container">
                        <i class="fas fa-inbox fa-2x mb-2"></i><br>
                        {{ noDataMessage || 'No grievances found.' }}
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
              <!-- <div class="table-section">
                <div
                  class="table-responsive"
                  [ngClass]="{ 'table-full-height': !showSearchSection }"
                >
                
                  <div
                    class="d-flex font-weight-bold border-bottom py-2 bg-light sticky-table-header align-items-center"
                  >
                    <div
                      class="text-center d-flex justify-content-center align-items-center"
                      style="width: 5%"
                    >
                      <input
                        type="checkbox"
                        class="custom-checkbox-modern"
                        [checked]="selectedItems.size === grievances.length"
                        (change)="onSelectAll($event)"
                      />
                    </div>
                    <div class="text-center" style="width: 5%">S.No.</div>
                    <div style="width: 30%">Name / Email</div>
                    <div style="width: 15%">Passport / Eqama</div>
                    <div style="width: 25%">Employer / Date</div>
                    <div class="text-center" style="width: 5%">View</div>
                    <div class="text-center" style="width: 5%">Reply</div>
                  </div>

                  
                  <div
                    *ngFor="let item of grievances; let i = index"
                    class="d-flex align-items-center border-bottom py-2 hover-row"
                  >
                    <div
                      class="text-center d-flex justify-content-center align-items-center"
                      style="width: 5%"
                    >
                      <input
                        type="checkbox"
                        class="custom-checkbox-modern"
                        [checked]="selectedItems.has(item.id)"
                        (change)="onItemSelect(item.id, $event)"
                      />
                    </div>

                    <div class="text-center" style="width: 5%">
                      {{ item.sno }}
                    </div>

                    <div style="width: 30%">
                      <b>{{ item.name }}</b
                      ><br />
                      <small class="text-muted">{{ item.email }}</small>
                    </div>

                    <div style="width: 15%">
                      <small>{{ item.passport }}</small
                      ><br />
                      <small class="text-muted">{{ item.var_eqama_no }}</small>
                    </div>

                    <div style="width: 25%">
                      <small>{{ item.employername }}</small
                      ><br />
                      <small class="text-muted">{{ item.cdate }}</small>
                    </div>

                   
                    <div class="text-center" style="width: 5%">
                      <button
                        class="btn btn-icon btn-link"
                        (click)="onViewClick(item)"
                        title="View"
                      >
                        <i
                          class="fa fa-eye status-icon"
                          style="color: darkcyan"
                        ></i>
                      </button>
                    </div>

                    
                    <div class="text-center" style="width: 5%">
                      <button
                        class="btn btn-icon btn-link"
                        (click)="onReplyClick(item)"
                        title="Reply"
                      >
                        <i
                          class="fa fa-envelope status-icon"
                          style="color: #007bff"
                        ></i>
                      </button>
                    </div>
                  </div>

                  
                  <div
                    *ngIf="grievances.length === 0"
                    class="text-center py-4 text-muted"
                  >
                    <i class="fas fa-inbox fa-2x mb-2"></i><br />
                    {{ noDataMessage || "No grievances found." }}
                  </div>
                </div>
              </div> -->
            </div>
            <app-pagination
              class="pagination-section sticky-table-footer"
              [currentPage]="currentPage"
              [pageSize]="pageSize"
              [totalRecords]="Number(totalRecords)"
              [totalPages]="totalPages"
              [jumpToPage]="jumpToPage"
              (pageChange)="onPageChange($event)"
              (jumpToPageChange)="onJumpToPage($event)"
            ></app-pagination>
          </div>
        </div>
      </div>
    </div>

    <!-- Reply Form Section -->
    <div class="row" *ngIf="addRecdFlg">
      <div class="col-md-12">
        <div class="card">
          <div class="card-header">
            <h4 class="card-title">Grievance Reply</h4>
          </div>
          <div class="card-body">
            <form [formGroup]="replyForm" (ngSubmit)="onSendReply()">
              <div class="row">
                <div class="col-md-4 col-lg-4">
                  <div class="input-group">
                    <input
                      type="email"
                      class="form-control"
                      id="emailTo"
                      (blur)="checkInput($event.target)"
                      formControlName="emailTo"
                      [ngClass]="{
                        'is-invalid':
                          replyForm.get('emailTo')?.invalid &&
                          (replyForm.get('emailTo')?.touched || submitted)
                      }"
                    />
                    <label for="emailTo">To</label>
                  </div>
                </div>
                <div class="col-md-4 col-lg-4">
                  <div class="input-group">
                    <input
                      type="text"
                      class="form-control"
                      id="emailcc"
                      (blur)="checkInput($event.target)"
                      formControlName="emailcc"
                    />
                    <label for="emailcc">CC</label>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-md-8">
                  <div>
                    <label for="emaildesc"
                      >Email Description
                      <span class="text-danger">*</span></label
                    >
                    <textarea
                      class="form-control"
                      id="emaildesc"
                      (blur)="checkInput($event.target)"
                      formControlName="emaildesc"
                      rows="10"
                      [ngClass]="{
                        'is-invalid':
                          replyForm.get('emaildesc')?.invalid &&
                          (replyForm.get('emaildesc')?.touched || submitted)
                      }"
                    ></textarea>
                  </div>
                </div>
              </div>
              <div class="form-group mt-3">
                <button
                  type="submit"
                  class="btn btn-outline-primary btn-round mr-2"
                >
                  <i class="fas fa-paper-plane mr-1"></i>Send
                </button>
                <button
                  type="button"
                  class="btn btn-outline-danger btn-round"
                  (click)="onCancelClick()"
                >
                  <i class="fas fa-times mr-1"></i>Cancel
                </button>
                <button
                  type="button"
                  class="btn btn-outline-dark btn-round mr-2"
                  (click)="clearReplyForm()"
                >
                  <i class="fas fa-eraser mr-1"></i>Clear
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- View Grievance Modal -->
    <div class="modal fade show d-block" tabindex="-1" *ngIf="viewModalOpen" style="background: rgba(0,0,0,0.5);">
      <div class="modal-dialog modal-sm modal-dialog-centered" [ngClass]="{ 'modal-fullscreen': isMaximized }">
        <div class="modal-content">
          <div class="modal-header modal-head text-white" style="background: var(--primary-color);">
            <h5 class="modal-title mb-0 fw-semibold">
              Grievance Details
            </h5>
            <div class="d-flex align-items-center ms-auto gap-2">
              <button type="button" class="btn btn-sm btn-outline-light" (click)="toggleMaximize()" [attr.aria-label]="isMaximized ? 'Restore' : 'Maximize'">
                <i class="fas" [ngClass]="isMaximized ? 'fa-compress' : 'fa-expand'"></i>
              </button>
              <button type="button" class="btn-close btn-close-white" aria-label="Close" (click)="closeViewModal()"></button>
            </div>
          </div>
          <div class="modal-body">
            <div *ngIf="viewGrievance">
              <div class="row g-3 align-items-center">
                <div class="col-md-8">
                  <div class="mb-2">
                    <label class="form-label fw-bold">Name:</label>
                    <span>{{ viewGrievance.name }}</span>
                  </div>
                  <div class="mb-2">
                    <label class="form-label fw-bold">Passport No:</label>
                    <span>{{ viewGrievance.passportNo }}</span>
                  </div>
                  <div class="mb-2">
                    <label class="form-label fw-bold">Contact No:</label>
                    <span>{{ viewGrievance.contactNo }}</span>
                  </div>
                  <div class="mb-2">
                    <label class="form-label fw-bold">Employer's Name:</label>
                    <span>{{ viewGrievance.employerName }}</span>
                  </div>
                  <div class="mb-2">
                    <label class="form-label fw-bold">Gender:</label>
                    <span>{{ viewGrievance.gender }}</span>
                  </div>
                  <div class="mb-2">
                    <label class="form-label fw-bold">Position:</label>
                    <span>{{ viewGrievance.position }}</span>
                  </div>
                  <div class="mb-2">
                    <label class="form-label fw-bold">Eqama No:</label>
                    <span>{{ viewGrievance.eqamaNo }}</span>
                  </div>
                  <div class="mb-2">
                    <label class="form-label fw-bold">Country of Deployment:</label>
                    <span>{{ viewGrievance.countryOfDeployment }}</span>
                  </div>
                  <div class="mb-2">
                    <label class="form-label fw-bold">Complaint:</label>
                    <span>{{ viewGrievance.complaint }}</span>
                  </div>
                </div>
                <div class="col-md-4 text-end">
                  <div *ngIf="viewGrievance.photo">
                    <img [src]="viewGrievance.photo" alt="Grievance Photo" class="img-fluid rounded shadow-sm border" style="max-width: 140px; max-height: 100px;">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- End View Grievance Modal -->
  </div>
</div>
