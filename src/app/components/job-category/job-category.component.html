<div class="content">
  <div class="page-inner">
    <div class="row" *ngIf="listRecdFlg">
      <div class="col-md-12">
        <div class="card">
          <div class="sticky-top-section" [ngClass]="{'search-hidden': !showSearchSection}">
            <!-- Search Section with Toggle Button -->
            <div class="card-body position-relative" *ngIf="showSearchSection">
              <button class="toggle-search-btn-minimal" (click)="toggleSearchSection()" type="button"
                data-bs-toggle="tooltip" title="Hide search">
                <i class="fas fa-chevron-up"></i>
              </button>
              <form [formGroup]="searchForm" (ngSubmit)="onSearch()">
                <div class="row align-items-center">
                  <div class="col-md-3 col-lg-3">
                    <div class="input-group">
                      <select class="form-control" id="parentCategorySearch" formControlName="parentCategorySearch"
                        (change)="onParentCategoryChange($event)" (blur)="checkInput($event.target)">
                        <option value=""></option>
                        <option *ngFor="let cat of parentCategories" [value]="cat.catId">{{ cat.catName }}</option>
                      </select>
                      <label for="parentCategorySearch">Parent Category</label>
                    </div>
                  </div>
                  <div class="col-md-3 col-lg-3">
                    <div class="input-group">
                      <select class="form-control" id="subCategorySearch" formControlName="subCategorySearch"
                        (blur)="checkInput($event.target)">
                        <option value=""></option>
                        <option *ngFor="let sub of subCategories" [value]="sub.subCatId">{{ sub.subCatName }}</option>
                      </select>
                      <label for="subCategorySearch">Sub Category</label>
                    </div>
                  </div>
                  <div class="col-md-3 col-lg-3">
                    <div class="input-group">
                      <input type="text" class="form-control" id="categoryTitleSearch"
                        formControlName="categoryTitleSearch" (blur)="checkInput($event.target)">
                      <label for="categoryTitleSearch">Category Title</label>
                    </div>
                  </div>
                  <div class="col-md-3 col-lg-3 d-flex align-items-end">
                    <div class="form-group w-100">
                      <button class="btn btn-outline-primary btn-round mr-2" type="submit">
                        <i class="fas fa-search mr-1"></i>Search
                      </button>
                      <button class="btn btn-outline-dark btn-round" type="button" (click)="onClearSearch()">
                        <i class="fas fa-times mr-1"></i>Clear
                      </button>
                    </div>
                  </div>
                </div>
              </form>
            </div>
            <!-- Show Search Button (when hidden) -->
            <button *ngIf="!showSearchSection" class="toggle-search-btn-minimal show-btn"
              (click)="toggleSearchSection()" type="button" data-bs-toggle="tooltip" title="Show search">
              <i class="fas fa-chevron-down"></i>
            </button>

            <!-- Main Card Header with Title and Action Buttons -->
            <div class="card-header">
              <div class="d-flex align-items-center justify-content-between">
                <h4 class="card-title mb-0">Job Category Management 
                  <span class="ml-2" style="font-size: 14px; font-weight: normal; color: var(--primary-color);">
                    ({{ (totalRecords | number:'1.0-0') === '0' ? '0 record' : totalRecords + ' records' }})
                  </span>
                </h4>
                <div class="action-buttons">
                  @if  (comp_id === superAdminID) {
                  <button class="btn btn-outline-primary btn-round mr-2" (click)="onShowAddForm()">
                    <i class="fas fa-plus mr-1"></i>Add Category
                  </button>
                  }
                  @if  (comp_id === superAdminID) {
                  <button class="btn btn-outline-info btn-round mr-2" (click)="onChangeVisibilityClick()"
                    [disabled]="selectedItems.size === 0">
                    <i class="fas fa-eye mr-1"></i>Change Status{{ selectedItems.size > 0 ? ' (' + selectedItems.size +
                    ')' : '' }}
                  </button>
                  }
                  @if  (comp_id === superAdminID) {
                    <!-- @if ((deleteOption != '' && deleteOption == '1') || (userId === '1' && userType == '1')) { -->
                    <button class="btn btn-outline-danger btn-round" (click)="onDeleteClick()"
                      [disabled]="selectedItems.size === 0">
                      <i class="fas fa-trash mr-1"></i>Delete{{ selectedItems.size > 0 ? ' (' + selectedItems.size + ')' :
                      '' }}
                    </button>
                    <!-- } -->
                  }
                </div>
              </div>
            </div>
          </div>

          <!-- Data Table Section -->
          <div class="table-section">
            <div class="table-responsive" [ngClass]="{'table-full-height': !showSearchSection}">
              <table class="table table-striped table-hover mb-0 ">
                <thead class="thead-light sticky-table-header">
                  <tr>
                    @if  (comp_id === superAdminID) {
                    <th class="text-center" style="width: 2%;">
                      <input type="checkbox" class="custom-checkbox-modern"
                        [checked]="selectedItems.size === jobCategories.length" (change)="onSelectAll($event)">
                    </th>
                    }
                    <th style="width: 3%;">S.NO.</th>
                    <th style="width: 25%;">TITLE</th>
                    <th>SUB CATEGORY</th>
                    <th style="width: 18%;">CATEGORY</th>
                    <th style="width: 10%;">DATE</th>
                    <th class="text-center" style="width: 5%;">STATUS</th>
                    @if  (comp_id === superAdminID) {
                    <th class="text-center" style="width: 3%;">EDIT</th>
                    }
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of jobCategories; let i = index">
                    @if  (comp_id === superAdminID) {
                    <td class="text-center">
                      <input type="checkbox" class="custom-checkbox-modern" [checked]="selectedItems.has(item.id)"
                        (change)="onItemSelect(item.id, $event)">
                    </td>
                    }
                    <td style="text-align: center;">{{ item.sno }}</td>
                    <td>{{ item.title }}</td>
                    <td>{{ item.pscat }}</td>
                    <td>{{ item.pacat }}</td>
                    <td>{{ item.cdate }}</td>
                    <td class="text-center">
                      <span *ngIf="item.status === '1'">
                        <i class="fas fa-check-circle text-success status-icon"></i>
                      </span>
                      <span *ngIf="item.status !== '1'">
                        <i class="fas fa-times-circle text-danger status-icon"></i>
                      </span>
                    </td>
                   @if  (comp_id === superAdminID) {
                    <td class="text-center">
                      <button type="button" class="btn btn-icon btn-link" title="Edit Record"
                        (click)="onEditClick(item)">
                        <i class="fa fa-edit status-icon"></i>
                      </button>
                    </td>
                    }
                  </tr>
                  <tr *ngIf="jobCategories.length === 0">
                    <td colspan="11" class="text-center text-muted py-4">
                      <i class="fas fa-inbox fa-2x mb-2"></i>
                      <br>{{ noDataMessage }}
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>

            <!-- Pagination Section (Sticky Footer) -->
            <app-pagination class="pagination-section sticky-table-footer" [currentPage]="currentPage"
              [pageSize]="pageSize" [totalRecords]="Number(totalRecords)" [totalPages]="totalPages"
              [jumpToPage]="jumpToPage" (pageChange)="onPageChange($event)" (jumpToPageChange)="onJumpToPage($event)">
            </app-pagination>
          </div>
        </div>
      </div>
    </div>

    <!-- Add/Edit Form Section -->
    <div class="row" *ngIf="addRecdFlg">
      <div class="col-md-12">
        <div class="card">
          <div class="card-header">
            <h4 class="card-title">{{ isEditMode ? 'Edit' : 'Add' }} Job Category
            </h4>
          </div>
          <div class="card-body">
            @if  (comp_id === superAdminID) {
            <form [formGroup]="jobCategoryForm">
              <div class="row">
                <div class="col-md-6 col-lg-6">
                  <div class="input-group">
                    <input type="text" class="form-control" id="categoryTitle" (input)="CreatAlias($event)"
                      (blur)="checkInput($event.target)" formControlName="categoryTitle">
                    <label for="categoryTitle">Category Title</label>
                  </div>
                </div>
                <div class="col-md-6 col-lg-6">
                  <div class="input-group">
                    <input type="text" class="form-control" id="categoryAlias" (blur)="checkInput($event.target)"
                      formControlName="categoryAlias" [readonly]="true">
                    <label for="categoryAlias">Category Alias</label>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-md-6 col-lg-6">
                  <div class="input-group">
                    <select class="form-control" id="parentCategory" (change)="onSelectChange($event)"
                      (blur)="checkInput($event.target)" formControlName="selectedParentCategory">
                      <option value=""></option>
                      <option *ngFor="let category of parentCategories" [value]="category.catId">{{ category.catName }}
                      </option>
                    </select>
                    <label for="parentCategory">Parent Category</label>
                  </div>
                </div>
                <div class="col-md-6 col-lg-6">
                  <div class="input-group">
                    <select class="form-control" id="parentSubCategory" (blur)="checkInput($event.target)"
                      formControlName="selectedParentSubCategory">
                      <option value=""></option>
                      <option *ngFor="let subCategory of subCategories" [value]="subCategory.subCatId">{{
                        subCategory.subCatName }}</option>
                    </select>
                    <label for="parentSubCategory">Parent Sub Category</label>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-md-6 col-lg-6">
                  <div class="input-group">
                    <input type="text" class="form-control" id="categoryDescription" (blur)="checkInput($event.target)"
                      formControlName="categoryDescription">
                    <label for="categoryDescription">Category Description</label>
                  </div>
                </div>
                <div class="col-md-6 col-lg-6">
                  <div class="form-group">
                    <label style="margin-top: 1rem; display: flex; align-items: center;">
                      <input class="custom-checkbox-modern" type="checkbox" value="" id="publishCheckbox"
                        formControlName="publish">
                      <span style="margin-left: 8px;">Publish</span>
                    </label>
                  </div>
                </div>
              </div>
              <div class="form-group mt-3">
                <button type="submit" class="btn btn-outline-primary btn-round mr-2"
                  (click)="isEditMode ? onUpdateRecord() : onSaveNewRecord()">
                  <i class="fas fa-save mr-1"></i>{{ isEditMode ? 'Update' : 'Save' }}
                </button>
                <button type="button" class="btn btn-outline-info btn-round mr-2" (click)="onCancelClick()">
                  <i class="fas fa-times mr-1"></i>Cancel
                </button>
                <button type="reset" class="btn btn-outline-dark btn-round" (click)="onClearClick()">
                  <i class="fas fa-eraser mr-1"></i>Clear
                </button>
              </div>
            </form>
            }
            @else {
            <div class="alert alert-danger" role="alert">
              You do not have permission to access this form.
            </div>
            }
          </div>
        </div>
      </div>
    </div>
  </div>
</div>