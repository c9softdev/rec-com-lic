<div class="content">
  <div class="page-inner">
    <div class="row" *ngIf="listRecdFlg">
      <div class="col-md-12">
        <div class="card">
          <div class="sticky-top-section" [ngClass]="{'search-hidden': !showSearchSection}">
            <!-- Search Section with Toggle Button -->
            <div class="card-body position-relative" *ngIf="showSearchSection">
              <button class="toggle-search-btn-minimal" (click)="toggleSearchSection()" type="button"
                data-bs-toggle="tooltip" title="Hide search">
                <i class="fas fa-chevron-up"></i>
              </button>
              <form [formGroup]="searchForm" (ngSubmit)="onSearch()">
                <div class="row align-items-center">
                  <div class="col-md-4 col-lg-4">
                    <div class="input-group">
                      <input type="text" class="form-control" id="scat_title" (blur)="checkInput($event.target)"
                        formControlName="scat_title">
                      <label for="scat_title">Qualification Name</label>
                    </div>
                  </div>
                  <div class="col-md-4 col-lg-4">
                    <div class="input-group">
                      <select class="form-control" id="sparCat" formControlName="sparCat"
                        (blur)="checkInput($event.target)">
                        <option value=""></option>
                        <option *ngFor="let qual of parentQualifications" [value]="qual.id">{{ qual.name }}</option>
                      </select>
                      <label for="sparCat">Parent Qualification</label>
                    </div>
                  </div>
                  <div class="col-md-4 col-lg-4 d-flex align-items-end">
                    <div class="form-group w-100">
                      <button class="btn btn-outline-primary btn-round mr-2" type="submit">
                        <i class="fas fa-search mr-1"></i>Search
                      </button>
                      <button class="btn btn-outline-dark btn-round" type="button" (click)="onClearSearch()">
                        <i class="fas fa-times mr-1"></i>Clear
                      </button>
                    </div>
                  </div>
                </div>
              </form>
            </div>
            <!-- Show Search Button (when hidden) -->
            <button *ngIf="!showSearchSection" class="toggle-search-btn-minimal show-btn"
              (click)="toggleSearchSection()" type="button" data-bs-toggle="tooltip" title="Show search">
              <i class="fas fa-chevron-down"></i>
            </button>

            <!-- Main Card Header with Title and Action Buttons -->
            <div class="card-header">
              <div class="d-flex align-items-center justify-content-between">
                <h4 class="card-title mb-0">Qualification Manager
                  <span class="ml-2" style="font-size: 14px; font-weight: normal; color: var(--primary-color);">
                    ({{ (totalRecords | number:'1.0-0') === '0' ? '0 record' : totalRecords + ' records' }})
                  </span>
                </h4>
                <div class="action-buttons">
                  <button class="btn btn-outline-primary btn-round mr-2" (click)="onShowAddForm()">
                    <i class="fas fa-plus mr-1"></i>Add Record
                  </button>
                  <button class="btn btn-outline-info btn-round mr-2" (click)="onChangeVisibilityClick()"
                    [disabled]="selectedItems.size === 0">
                    <i class="fas fa-eye mr-1"></i>Change Visibility{{ selectedItems.size > 0 ? ' (' +
                    selectedItems.size + ')' : '' }}
                  </button>
                  @if ((deleteOption != '' && deleteOption == '1') || (userId === '1' && userType == '1')) {
                  <button class="btn btn-outline-danger btn-round" (click)="onDeleteClick()"
                    [disabled]="selectedItems.size === 0">
                    <i class="fas fa-trash mr-1"></i>Delete{{ selectedItems.size > 0 ? ' (' + selectedItems.size + ')' :
                    '' }}
                  </button>
                  }
                </div>
              </div>
            </div>
          </div>

          <!-- Data Table Section -->
          <div class="table-section">
            <div class="table-responsive" [ngClass]="{'table-full-height': !showSearchSection}">
              <table class="table table-striped table-hover mb-0">
                <thead class="thead-light sticky-table-header">
                  <tr>
                    <th class="text-center" style="width: 2%;">
                      <input type="checkbox" class="custom-checkbox-modern"
                        [checked]="selectedItems.size === qualifications.length && qualifications.length > 0"
                        (change)="onSelectAll($event)">
                    </th>
                    <th style="width: 5%;">S.NO.</th>
                    <th>Qualification Name</th>
                    <th>Parent Category</th>
                    <th class="text-center" style="width: 10%;">Publish</th>
                    @if ((editresumechk != '' && editresumechk == '1') || (userId === '1' && userType == '1')) {
                    <th class="text-center" style="width: 5%;">Edit</th>
                    }
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of qualifications; let i = index">
                    <td class="text-center">
                      <input type="checkbox" class="custom-checkbox-modern" [checked]="selectedItems.has(item.id)"
                        (change)="onItemSelect(item.id, $event)">
                    </td>
                    <td style="text-align: center;">{{ item.sno }}</td>
                    <td>{{ item.qualifiction }}</td>
                    <td>{{ item.pacat }}</td>
                    <td class="text-center">
                      <span *ngIf="item.status === '1'">
                        <i class="fas fa-check-circle text-success status-icon"></i>
                      </span>
                      <span *ngIf="item.status !== '1'">
                        <i class="fas fa-times-circle text-danger status-icon"></i>
                      </span>
                    </td>
                    @if ((editresumechk != '' && editresumechk == '1') || (userId === '1' && userType == '1')) {
                    <td class="text-center">
                      <button type="button" class="btn btn-icon btn-link" title="Edit Record"
                        (click)="onEditClick(item)">
                        <i class="fa fa-edit status-icon"></i>
                      </button>
                    </td>
                    }
                  </tr>
                  <tr *ngIf="qualifications.length === 0" class="table-no-data-row">
                    <td colspan="9" class="table-no-data-cell">
                      <div class="no-data-center-container">
                        <i class="fas fa-inbox fa-2x mb-2"></i><br>
                        {{ noDataMessage || 'No qualifications found.' }}
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <app-pagination class="pagination-section sticky-table-footer" [currentPage]="currentPage"
              [pageSize]="pageSize" [totalRecords]="Number(totalRecords)" [totalPages]="totalPages"
              [jumpToPage]="jumpToPage" (pageChange)="onPageChange($event)" (jumpToPageChange)="onJumpToPage($event)">
            </app-pagination>
          </div>
        </div>
      </div>
    </div>

    <!-- Add/Edit Form Section -->
    <div class="row" *ngIf="addRecdFlg">
      <div class="col-md-12">
        <div class="card">
          <div class="card-header">
            <h4 class="card-title">{{ isEditMode ? 'Edit' : 'Add' }} Qualification</h4>
          </div>
          <div class="card-body">
            <form [formGroup]="qualificationForm">
              <div class="row">
                <div class="col-md-6 col-lg-6">
                  <div class="input-group">
                    <input type="text" class="form-control" id="quli_title" (blur)="checkInput($event.target)"
                      formControlName="quli_title">
                    <label for="quli_title">Qualification Title</label>
                  </div>
                </div>
                <div class="col-md-6 col-lg-6">
                  <div class="input-group">
                    <select class="form-control" id="pcat" formControlName="pcat" (blur)="checkInput($event.target)">
                      <option value=""></option>
                      <option *ngFor="let parent of parentQualifications" [value]="parent.id">{{ parent.name }}</option>
                    </select>
                    <label for="pcat">Parent Qualification</label>
                  </div>
                </div>
              </div>
              <div class="form-group d-flex align-items-center" style="margin-top: 1rem; gap: 24px;">
                <label
                  style="font-weight: 600; font-size: 1rem; display: flex; align-items: center; gap: 0px; margin-bottom: 0;">
                  <input class="custom-checkbox-modern" type="checkbox" id="publishCheckbox" formControlName="status">
                  <span style="font-weight: 600;">Publish</span>
                </label>
              </div>
              <div class="form-group mt-3">
                <button type="button" class="btn btn-outline-primary btn-round mr-2"
                  (click)="isEditMode ? onUpdateRecord() : onSaveNewRecord()">
                  <i class="fas fa-save mr-1"></i>{{ isEditMode ? 'Update' : 'Save' }}
                </button>
                <button type="button" class="btn btn-outline-info btn-round mr-2" (click)="onCancelClick()">
                  <i class="fas fa-times mr-1"></i>Cancel
                </button>
                <button type="reset" class="btn btn-outline-dark btn-round" (click)="onClearClick()">
                  <i class="fas fa-eraser mr-1"></i>Clear
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>